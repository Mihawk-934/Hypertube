{"ast":null,"code":"var _jsxFileName = \"/Users/miclaude/Desktop/react/Netflix/netflix2/src/containers/Auth/authPhone.jsx\";\nimport React, { Component } from 'react';\nimport { Button, Form } from 'react-bootstrap';\nimport firebase from '../../fire';\nimport * as regex from './Regex';\nimport { withRouter } from 'react-router-dom';\nimport * as actions from '../../store/actions/index';\nimport { connect } from 'react-redux';\n\nclass Phone extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      phone: null,\n      codeVerification: null,\n      error: {},\n      // error1:{},\n      errorCatch: '',\n      disable: true,\n      // disable1:true,\n      // confirmResult: null,\n      show: false,\n      codeError: null\n    };\n\n    this.handleFormValidcode = () => {\n      let store = '';\n      const error = { ...this.state.error1\n      };\n      const values = Object.values(error);\n\n      for (const key of values) store += key;\n\n      Object.keys(error).length === 1 && store.length === 0 ? this.setState({\n        disable1: false\n      }) : this.setState({\n        disable1: true\n      }, () => {\n        console.log(this.state.disable1);\n      });\n    };\n\n    this.handleFormValidphone = () => {\n      let store = '';\n      const error = { ...this.state.error\n      };\n      const values = Object.values(error);\n\n      for (const key of values) store += key;\n\n      Object.keys(error).length === 1 && store.length === 0 ? this.setState({\n        disable: false\n      }) : this.setState({\n        disable: true\n      }, () => {\n        console.log('ici');\n      });\n    };\n\n    this.handleInputValid = (name_input, value_input) => {\n      let error = { ...this.state.error\n      }; // let error1 = {...this.state.error1};\n\n      switch (name_input) {\n        case 'phone':\n          value_input.match(regex.phoneNumber) ? error[name_input] = '' : error[name_input] = \"*Numero non valide\";\n          break;\n\n        case 'codeVerification':\n          value_input.match(regex.codeVerification) && value_input.length > 5 ? error[name_input] = '' : error[name_input] = \"*Mauvais format 5 chiffres sont attendues\";\n          break;\n\n        default:\n          console.log(\"NUMBER NOT FOUND\");\n      }\n\n      if (name_input === 'phone') this.setState({\n        error: error\n      }, () => {\n        this.handleFormValidphone();\n      });\n      this.setState({\n        error: error\n      }, () => {\n        this.handleFormValidcode();\n      });\n    };\n\n    this.handleInput = event => {\n      const nameInput = event.target.id;\n      const valueInput = event.target.value;\n      this.setState({\n        [event.target.id]: event.target.value\n      }, () => {\n        this.handleInputValid(nameInput, valueInput);\n      });\n    };\n\n    this.sendCode = e => {\n      e.preventDefault();\n      firebase.auth().languageCode = 'fr';\n      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\"recaptcha-container\", {\n        size: \"invisible\"\n      });\n      let phoneNumber = this.state.phone;\n      let appVerifier = window.recaptchaVerifier;\n      firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier).then(confirmationResult => {\n        this.setState({\n          show: true,\n          disable: true\n        });\n        window.confirmationResult = confirmationResult;\n      }).catch(error => {\n        this.setState({\n          errorCatch: error.message\n        });\n      });\n    };\n\n    this.receiveCode = e => {\n      e.preventDefault();\n      const verificationId = this.state.codeVerification;\n      window.confirmationResult.confirm(verificationId).then(result => {\n        localStorage.setItem('id', result.user.uid);\n        localStorage.setItem('token', result.user.ma);\n        this.props.onPhone(result.user.ma, result.user.uid);\n        this.props.history.push('/home');\n      }).catch(error => {\n        this.setState({\n          codeError: 'Error lors de la verification du code: code invalide'\n        });\n      });\n    };\n  }\n\n  render() {\n    let msg;\n    let form;\n    let msgCatch;\n    msg = /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 15\n      }\n    }, this.state.error.phone);\n    if (this.state.errorCatch && this.state.codeError === null) msgCatch = /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 24\n      }\n    }, \"Trop d'essai votre compte a \\xE9t\\xE9 suspendu temporairement.\");\n    if (this.state.codeError) msgCatch = /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 24\n      }\n    }, \"Le code ne coresspond pas a celui qui vous a \\xE9t\\xE9 envoyer veuillez ressayer\");\n    if (this.state.show && this.state.codeError === null) msgCatch = /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 24\n      }\n    }, \"Un code vient de vous etre envoyer par SMS.\");\n\n    if (this.state.show === true) {\n      form = /*#__PURE__*/React.createElement(Form.Group, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }\n      }, \"Connexion via Smarthpone\"), /*#__PURE__*/React.createElement(Form.Control, {\n        id: \"phone\",\n        type: \"tel\",\n        placeholder: \"Entrer votre numero de telephone ex :+33625145895\",\n        onChange: e => this.handleInput(e),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(Form.Text, {\n        className: \"text-muted\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 21\n        }\n      }, this.state.error.phone ? msg : null), /*#__PURE__*/React.createElement(Button, {\n        id: \"recaptcha-container\",\n        disabled: this.state.disable,\n        onClick: e => this.sendCode(e),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 21\n        }\n      }, \"Envoyer code\"));\n    }\n\n    if (this.state.show === false) {\n      form = /*#__PURE__*/React.createElement(Form.Group, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 21\n        }\n      }, \"Connexion via Smarthpone\"), /*#__PURE__*/React.createElement(Form.Control, {\n        id: \"codeVerification\",\n        type: \"tel\",\n        placeholder: \"Entrer le code de verification\",\n        onChange: e => this.handleInput(e),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(Form.Text, {\n        className: \"text-muted\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 21\n        }\n      }, this.state.error.codeVerification), /*#__PURE__*/React.createElement(Button, {\n        id: \"code\",\n        disabled: this.state.disable,\n        onClick: e => this.receiveCode(e),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 21\n        }\n      }, \"S'inscrire\"));\n    }\n\n    return /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.onSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 13\n      }\n    }, form, msgCatch);\n  }\n\n}\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    onPhone: (token, userId) => dispatch(actions.authSuccess(token, userId))\n  };\n};\n\nexport default withRouter(connect(null, mapDispatchToProps)(Phone));","map":{"version":3,"sources":["/Users/miclaude/Desktop/react/Netflix/netflix2/src/containers/Auth/authPhone.jsx"],"names":["React","Component","Button","Form","firebase","regex","withRouter","actions","connect","Phone","state","phone","codeVerification","error","errorCatch","disable","show","codeError","handleFormValidcode","store","error1","values","Object","key","keys","length","setState","disable1","console","log","handleFormValidphone","handleInputValid","name_input","value_input","match","phoneNumber","handleInput","event","nameInput","target","id","valueInput","value","sendCode","e","preventDefault","auth","languageCode","window","recaptchaVerifier","RecaptchaVerifier","size","appVerifier","signInWithPhoneNumber","then","confirmationResult","catch","message","receiveCode","verificationId","confirm","result","localStorage","setItem","user","uid","ma","props","onPhone","history","push","render","msg","form","msgCatch","onSubmit","mapDispatchToProps","dispatch","token","userId","authSuccess"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport {Button, Form} from 'react-bootstrap'\nimport firebase from '../../fire';\nimport * as regex from './Regex'\nimport { withRouter } from 'react-router-dom';\nimport * as actions from '../../store/actions/index';\nimport { connect } from 'react-redux';\n\nclass Phone extends Component {\n    state = {\n        phone: null,\n        codeVerification: null,\n        error:{},\n        // error1:{},\n        errorCatch:'',\n        disable:true,\n        // disable1:true,\n        // confirmResult: null,\n        show: false,\n        codeError:null\n    }\n\n    handleFormValidcode = () => { \n        let store = ''; \n        const error = {...this.state.error1};\n        const values = Object.values(error)\n        for (const key of values)\n            store += key;\n        Object.keys(error).length===1 && store.length===0? this.setState({disable1:false}):this.setState({disable1:true},()=>{console.log(this.state.disable1)});\n    }\n\n    handleFormValidphone = () => { \n        let store = ''; \n        const error = {...this.state.error};\n        const values = Object.values(error)\n        for (const key of values)\n            store += key;\n        Object.keys(error).length === 1 && store.length === 0 ? this.setState({disable:false}) : this.setState({disable:true},()=>{console.log('ici')});\n    }\n\n    handleInputValid = (name_input,value_input) => {\n        let error = {...this.state.error};\n        // let error1 = {...this.state.error1};\n        switch(name_input){\n            case 'phone': value_input.match(regex.phoneNumber)  ? error[name_input]='' : error[name_input] = \"*Numero non valide\";\n                break;\n            case 'codeVerification': value_input.match(regex.codeVerification) && value_input.length>5 ? error[name_input]='' : error[name_input] = \"*Mauvais format 5 chiffres sont attendues\";\n                 break;\n            default:\n                console.log(\"NUMBER NOT FOUND\");\n        }\n        if (name_input === 'phone')\n        this.setState({error:error}, () => {this.handleFormValidphone()});\n        this.setState({error:error}, () => {this.handleFormValidcode()});\n    }\n     \n    handleInput = (event) => {\n        const nameInput = event.target.id;\n        const valueInput = event.target.value;\n        this.setState({[event.target.id]:event.target.value},\n            () => {this.handleInputValid(nameInput,valueInput)    \n        });\n    }\n\n    sendCode = (e) => {  \n        e.preventDefault();\n        firebase.auth().languageCode = 'fr';\n        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\"recaptcha-container\",\n        {\n           size:\"invisible\"\n        });\n        let phoneNumber = this.state.phone;\n        let appVerifier = window.recaptchaVerifier;\n        firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)\n        .then(confirmationResult => { \n            this.setState({show:true, disable: true})\n            window.confirmationResult = confirmationResult;\n        })\n        .catch(error => {\n            this.setState({errorCatch:error.message})\n        });\n    }\n    \n    receiveCode = (e) => {\n        e.preventDefault();\n        const verificationId = this.state.codeVerification;\n        window.confirmationResult\n        .confirm(verificationId)\n        .then(result => {\n            localStorage.setItem('id',result.user.uid)\n            localStorage.setItem('token', result.user.ma)\n            this.props.onPhone(result.user.ma,result.user.uid);\n            this.props.history.push('/home')\n        })\n        .catch(error => {\n            this.setState({codeError:'Error lors de la verification du code: code invalide'})\n        });\n    }\n   \n    render() {\n        let msg;\n        let form;\n        let msgCatch;\n       \n        msg = <p>{this.state.error.phone}</p>;\n\n        if (this.state.errorCatch && this.state.codeError === null)\n            msgCatch = <p>Trop d'essai votre compte a été suspendu temporairement.</p>\n        \n        if (this.state.codeError)\n            msgCatch = <p>Le code ne coresspond pas a celui qui vous a été envoyer veuillez ressayer</p>\n  \n        if (this.state.show && this.state.codeError === null)\n            msgCatch = <p>Un code vient de vous etre envoyer par SMS.</p>\n        \n        if (this.state.show === true){\n            form= (\n                <Form.Group >\n                    <Form.Label>Connexion via Smarthpone</Form.Label> \n                    <Form.Control id=\"phone\" type=\"tel\" placeholder=\"Entrer votre numero de telephone ex :+33625145895\"   onChange={(e)=>this.handleInput(e)}/>\n                    <Form.Text className=\"text-muted\">         \n                        {this.state.error.phone ? msg : null }     \n                    </Form.Text>\n                    <Button id=\"recaptcha-container\" disabled={this.state.disable} onClick={(e)=>this.sendCode(e)}>\n                        Envoyer code\n                    </Button>\n                </Form.Group>\n            )\n        }\n        \n        if (this.state.show === false){\n            form = (\n                <Form.Group >\n                    <Form.Label>Connexion via Smarthpone</Form.Label>\n                    <Form.Control id=\"codeVerification\" type=\"tel\" placeholder=\"Entrer le code de verification\" onChange={(e)=>this.handleInput(e)} />\n                    <Form.Text className=\"text-muted\">         \n                        {this.state.error.codeVerification}   \n                    </Form.Text>\n                    <Button id=\"code\" disabled={this.state.disable} onClick={(e)=>this.receiveCode(e)}>\n                        S'inscrire\n                    </Button> \n                </Form.Group>\n            )\n        }\n\n        return (\n            <Form onSubmit={this.onSubmit}>\n                {form}\n                {msgCatch}\n            </Form>   \n        )\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        onPhone: (token, userId) => dispatch(actions.authSuccess(token, userId))\n    };\n};\n\nexport default withRouter(connect(null, mapDispatchToProps) (Phone));\n"]},"metadata":{},"sourceType":"module"}